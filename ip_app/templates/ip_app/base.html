{% load compress %}

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'ip_app/img/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'ip_app/img/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'ip_app/img/favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'ip_app/img/favicon/site.webmanifest' %}">
    
    <!-- Primary Meta Tags - Optimized Length -->
    <title>{% block title %}What Is My IP Address | Fast & Free IP Location Lookup{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Instantly see your IP address with our free lookup tool. Get location, ISP details, and network information for any IPv4 or IPv6 address.{% endblock %}">
    <meta name="keywords" content="what is my ip, my ip, ip address lookup, ip location, ip finder, ipv4, ipv6, geolocation">
    
    <!-- Canonical Tag -->
    <link rel="canonical" href="https://whatismyipaddress.world{{ request.path }}">
    
    <!-- Mobile-specific meta -->
    <meta name="theme-color" content="#1b4a6b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="robots" content="index, follow">
    <meta name="author" content="WhatIsMyIPAddress.World">
    
    {% block extra_meta %}{% endblock %}

    <!-- Resource Hints - Preconnect to important domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://flagcdn.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
    <link rel="dns-prefetch" href="//tile.openstreetmap.org">
    
    <!-- Critical CSS -->
    <style>
        /* Critical styles for above-the-fold content */
        body{min-height:100vh;font-family:'Inter',sans-serif;color:#333;background-color:#f9fafb;margin:0;padding:0}
        .container{width:100%;max-width:1200px;margin:0 auto;padding:0 1rem}
        header{background-color:#fff;box-shadow:0 1px 2px rgba(0,0,0,.05)}
        .loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:50;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}
        .hidden{display:none}
        .flex{display:flex}
        .items-center{align-items:center}
        .justify-between{justify-content:space-between}
        .text-xl{font-size:1.25rem;line-height:1.75rem}
        .font-bold{font-weight:700}
        .text-secondary{color:#2a9fd6}
        .text-gray-400{color:#9ca3af}
        .text-primary-700{color:#1e40af}
        .min-h-screen{min-height:100vh}
        .flex-col{flex-direction:column}
        .bg-gray-50{background-color:#f9fafb}
        .text-gray-800{color:#1f2937}
        .py-3{padding-top:0.75rem;padding-bottom:0.75rem}
        .px-4{padding-left:1rem;padding-right:1rem}
        .shadow-sm{box-shadow:0 1px 2px 0 rgba(0,0,0,0.05)}
        @media (min-width:640px){.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:py-4{padding-top:1rem;padding-bottom:1rem}}
    </style>
    
    <!-- Preload key assets -->
    <link rel="preload" href="{% static 'ip_app/css/styles.min.css' %}" as="style">
    <link rel="preload" href="{% static 'ip_app/js/main.min.js' %}" as="script">
    
    <!-- Font Awesome - Optimized loading -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"></noscript>
    {% compress css %}
    <link rel="stylesheet" href="{% static 'ip_app/css/styles.css' %}">
    {% endcompress %}
    
    
     
    <!-- Leaflet Map CSS - Load when needed -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" media="print" onload="this.media='all'">
    
    <!-- Google Fonts - Optimized loading -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"></noscript>

    {% block extra_css %}{% endblock %}
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "What Is My IP Address",
        "url": "https://whatismyipaddress.world/",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://whatismyipaddress.world/lookup?ip={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>

    <!-- AdSense - Async Loading -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6913093595582462" crossorigin="anonymous"></script>
</head>

<body class="min-h-screen flex flex-col bg-gray-50 text-gray-800">
    <!-- Google Tag Manager - Optimized for async loading -->
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FT20Y3JPXD', { 'anonymize_ip': true, 'transport_type': 'beacon' });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FT20Y3JPXD"></script>

    <!-- Loading Overlay - Enhanced Animation -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="text-center px-4">
            <div class="inline-block animate-spin rounded-full h-12 w-12 sm:h-16 sm:w-16 border-t-4 border-b-4 border-secondary"></div>
            <p class="mt-4 text-white text-base sm:text-lg">Loading IP information...</p>
        </div>
    </div>

    <!-- Skip to Content Link for Accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary-700 text-white px-4 py-2 z-50">Skip to content</a>

    <!-- Navigation - Enhanced for Mobile and Performance -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-3 sm:py-4">
            <div class="flex justify-between items-center">
                <a href="/" class="text-xl sm:text-2xl font-bold flex items-center" title="What Is My IP Address - Home">
                    <span class="text-secondary">What</span>
                    <span class="text-gray-400 mx-1">Is</span>
                    <span class="text-secondary">My</span>
                    <span class="text-primary-700 font-extrabold mx-1">IP</span>
                    <span class="text-gray-500 hidden sm:inline">Address</span>
                </a>
                
                <!-- Desktop Navigation - Hidden on Small Screens -->
                <nav class="hidden md:flex items-center space-x-4 sm:space-x-6" aria-label="Main navigation">
                    <a href="/ip-lookup" class="text-gray-600 hover:text-secondary transition py-1 px-1 rounded-md hover:bg-gray-100">IP Lookup</a>
                    <a href="/contact" class="text-gray-600 hover:text-secondary transition py-1 px-1 rounded-md hover:bg-gray-100">Contact</a>
                </nav>
                
                <!-- Mobile Menu Button - Only Visible on Small Screens -->
                <button class="md:hidden text-gray-600 focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2 p-1 rounded-md" id="mobileMenuButton" aria-expanded="false" aria-label="Toggle navigation menu">
                    <i class="fas fa-bars text-xl" aria-hidden="true"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu - Enhanced for Accessibility and Performance -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-100" aria-labelledby="mobileMenuButton">
            <div class="container mx-auto px-4 py-2">
                <nav class="flex flex-col space-y-1" aria-label="Mobile navigation">
                    <a href="/ip-lookup" class="text-gray-600 py-2 px-3 hover:bg-gray-50 hover:text-secondary transition rounded-md">My IP</a>
                    <a href="/#faq" class="text-gray-600 py-2 px-3 hover:bg-gray-50 hover:text-secondary transition rounded-md">FAQ</a>
                    <a href="/contact" class="text-gray-600 py-2 px-3 hover:bg-gray-50 hover:text-secondary transition rounded-md">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow">
        {% block content %}
        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 sm:py-12">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 sm:gap-6">
                <div>
                    <h3 class="text-xl font-bold mb-3 sm:mb-4">About</h3>
                    <p class="text-gray-300 text-sm sm:text-base">Get detailed information about IP addresses, including location, ISP, and network details with our free "What Is My IP" tool.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-3 sm:mb-4">Quick Links</h3>
                    <ul class="space-y-1 sm:space-y-2 text-sm sm:text-base text-gray-300">
                        <li><a href="/" class="hover:text-white transition font-medium">My IP</a></li>
                        <li><a href="/ip-lookup" class="hover:text-white transition font-medium">IP Lookup</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-3 sm:mb-4">Legal</h3>
                    <ul class="space-y-1 sm:space-y-2 text-sm sm:text-base text-gray-300">
                        <li><a href="/privacy" class="hover:text-white transition font-medium">Privacy Policy</a></li>
                        <li><a href="/terms" class="hover:text-white transition font-medium">Terms of Service</a></li>
                        <li><a href="/contact" class="hover:text-white transition font-medium">Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-3 sm:mb-4">Support</h3>
                    <p class="text-gray-300 text-sm sm:text-base">For support: <a href="mailto:manikant007y@gmail.com" class="text-secondary hover:text-white transition font-medium">manikant007y@gmail.com</a></p>
                </div>
            </div>
            
            <div class="mt-6 sm:mt-8 pt-6 sm:pt-8 border-t border-gray-700 text-center text-sm sm:text-lg font-semibold text-gray-400">
                <p>© {% now "Y" %} WhatIsMyIPAddress.World. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Toast Container for Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- Main JavaScript - With defer for better performance -->
    <script src="{% static 'ip_app/js/main.min.js' %}" defer></script>
    
    <!-- Load Leaflet script only when needed -->
    <script>
        // Lazy load Leaflet only if map container exists
        document.addEventListener('DOMContentLoaded', function() {
            const mapContainer = document.getElementById('ip-map');
            if (mapContainer && !window.L) {
                const leafletScript = document.createElement('script');
                leafletScript.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
                leafletScript.defer = true;
                document.body.appendChild(leafletScript);
            }
        });
    </script>
    
    <script>
        // Mobile menu toggle with better accessibility
        document.addEventListener('DOMContentLoaded', function() {
            const menuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (menuButton && mobileMenu) {
                menuButton.addEventListener('click', function() {
                    const expanded = menuButton.getAttribute('aria-expanded') === 'true' || false;
                    menuButton.setAttribute('aria-expanded', !expanded);
                    mobileMenu.classList.toggle('hidden');
                    
                    // Toggle icon between bars and times
                    const icon = menuButton.querySelector('i');
                    if (icon) {
                        if (expanded) {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        } else {
                            icon.classList.remove('fa-bars');
                            icon.classList.add('fa-times');
                        }
                    }
                });
            }
            
            // Enhanced loading spinner functions
            window.showLoader = function(message = 'Loading IP information...') {
                const loader = document.getElementById('loadingOverlay');
                if (loader) {
                    const messageElement = loader.querySelector('p');
                    if (messageElement) messageElement.textContent = message;
                    loader.classList.remove('opacity-0', 'pointer-events-none');
                    // Set aria-busy for accessibility
                    document.body.setAttribute('aria-busy', 'true');
                }
            }
            
            window.hideLoader = function() {
                const loader = document.getElementById('loadingOverlay');
                if (loader) {
                    loader.classList.add('opacity-0', 'pointer-events-none');
                    // Reset aria-busy
                    document.body.setAttribute('aria-busy', 'false');
                }
            }
            
            // Improved toast notification system
            window.showToast = function(message, type = 'info') {
                // Get toast container
                let toastContainer = document.getElementById('toast-container');
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.id = 'toast-container';
                    toastContainer.className = 'fixed top-4 right-4 z-50 flex flex-col gap-2';
                    document.body.appendChild(toastContainer);
                }
                
                // Create toast with improved accessibility
                const toast = document.createElement('div');
                toast.className = 'toast-notification flex items-center p-3 rounded shadow-lg text-white transform transition-all duration-300 translate-x-full max-w-xs sm:max-w-sm';
                toast.setAttribute('role', 'alert');
                toast.setAttribute('aria-live', 'polite');
                
                // Set background color based on type
                if (type === 'success') {
                    toast.classList.add('bg-green-600');
                } else if (type === 'error') {
                    toast.classList.add('bg-red-600');
                } else {
                    toast.classList.add('bg-primary-700');
                }
                
                // Set icon based on type
                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                if (type === 'error') icon = 'exclamation-circle';
                
                toast.innerHTML = `
                    <i class="fas fa-${icon} mr-2" aria-hidden="true"></i>
                    <span class="text-sm sm:text-base">${message}</span>
                    <button class="ml-auto text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 rounded-full p-1" onclick="this.parentElement.remove()" aria-label="Close notification">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                `;
                
                // Add to container
                toastContainer.appendChild(toast);
                
                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                }, 10);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 5000);
            }
            
            // Lazy load images
            if ('loading' in HTMLImageElement.prototype) {
                // Browser supports native lazy loading
                const images = document.querySelectorAll('img[loading="lazy"]');
                images.forEach(img => {
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    }
                });
            } else {
                // Fallback for browsers that don't support native lazy loading
                if ('IntersectionObserver' in window) {
                    const imageObserver = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                if (img.dataset.src) {
                                    img.src = img.dataset.src;
                                    img.removeAttribute('data-src');
                                }
                                imageObserver.unobserve(img);
                            }
                        });
                    });
                    
                    document.querySelectorAll('img[data-src]').forEach(img => {
                        imageObserver.observe(img);
                    });
                }
            }
        });
        
        // Enhanced cookie functions with security improvements
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days*24*60*60*1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/; SameSite=Lax; Secure";
        }
        
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i=0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        
        function acceptCookies() {
            setCookie('cookie_consent', 'accepted', 365);
            const consentBanner = document.getElementById('cookieConsent');
            if (consentBanner) {
                consentBanner.classList.add('hidden');
            }
            if (window.showToast) {
                window.showToast('Cookies accepted. Thank you!', 'success');
            }
        }
        
        function declineCookies() {
            setCookie('cookie_consent', 'declined', 365);
            const consentBanner = document.getElementById('cookieConsent');
            if (consentBanner) {
                consentBanner.classList.add('hidden');
            }
            if (window.showToast) {
                window.showToast('Cookies declined. Some features may be limited.', 'info');
            }
        }
    </script>
    
    {% block extra_js %}{% endblock %}
    {% compress js %}
<script src="{% static 'ip_app/js/main.js' %}"></script>
{% endcompress %}</script>
</body>
</html>